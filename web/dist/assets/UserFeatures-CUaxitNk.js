import{p as I,a4 as F,r as m,v as B,a5 as N,j as e,t as A,a6 as me,n as ge,w as Y,c as W,a7 as Q,B as k,T as y,h as w,k as pe,N as T,a as E,V as C,S as xe,R as Z,a8 as X,a9 as ee,aa as se,f as D,i as z,ab as J,L as je,g as L,ac as V,ad as P,ae as U,af as fe,ag as ye,ah as Se,H as ke}from"./index-DxdKUaIe.js";import{a as te,M as ae,b as re,d as oe,e as ne,f as _,T as ce,C as ve,S as be}from"./ChevronDown-C4xmPq1E.js";import{E as we}from"./ExternalLink-DKQCU2V3.js";import{B as Ce,a as G,b as K}from"./breadcrumb-item-B60tr35O.js";const R=I((t,o)=>{const{className:f,...p}=t,{bodyId:g,setBodyMounted:h}=F();m.useEffect(()=>(h(!0),()=>h(!1)),[h]);const x=B("chakra-modal__body",f),j=N();return e.jsx(A.div,{ref:o,className:x,id:g,...p,__css:j.body})});R.displayName="ModalBody";const H=I((t,o)=>{const{onClick:f,className:p,...g}=t,{onClose:h}=F(),x=B("chakra-modal__close-btn",p),j=N();return e.jsx(me,{ref:o,__css:j.closeButton,className:x,onClick:ge(f,v=>{v.stopPropagation(),h()}),...g})});H.displayName="ModalCloseButton";const $=I((t,o)=>{const{className:f,...p}=t,g=B("chakra-modal__footer",f),h=N(),x=Y({display:"flex",alignItems:"center",justifyContent:"flex-end",...h.footer});return e.jsx(A.footer,{ref:o,...p,__css:x,className:g})});$.displayName="ModalFooter";const q=I((t,o)=>{const{className:f,...p}=t,{headerId:g,setHeaderMounted:h}=F();m.useEffect(()=>(h(!0),()=>h(!1)),[h]);const x=B("chakra-modal__header",f),j=N(),v=Y({flex:0,...j.header});return e.jsx(A.header,{ref:o,className:x,id:g,...p,__css:v})});q.displayName="ModalHeader";const Ee=W({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),ie=W({displayName:"DeleteIcon",path:e.jsx("g",{fill:"currentColor",children:e.jsx("path",{d:"M19.452 7.5H4.547a.5.5 0 00-.5.545l1.287 14.136A2 2 0 007.326 24h9.347a2 2 0 001.992-1.819L19.95 8.045a.5.5 0 00-.129-.382.5.5 0 00-.369-.163zm-9.2 13a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zm5 0a.75.75 0 01-1.5 0v-9a.75.75 0 011.5 0zM22 4h-4.75a.25.25 0 01-.25-.25V2.5A2.5 2.5 0 0014.5 0h-5A2.5 2.5 0 007 2.5v1.25a.25.25 0 01-.25.25H2a1 1 0 000 2h20a1 1 0 000-2zM9 3.75V2.5a.5.5 0 01.5-.5h5a.5.5 0 01.5.5v1.25a.25.25 0 01-.25.25h-5.5A.25.25 0 019 3.75z"})})}),le=W({displayName:"EditIcon",path:e.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),de="spoke_saved_searches",_e=()=>{const[t,o]=m.useState([]),[f,p]=m.useState(!0),[g,h]=m.useState(null),x=m.useCallback(async()=>{p(!0),h(null);try{const l=ze();o(l);try{const n=await fetch("/api/v2/saved-searches");if(n.ok){const s=(await n.json()).saved_searches||[];o(Ie(l,s))}}catch{console.log("API not available, using localStorage only")}}catch(l){h(l instanceof Error?l.message:"Failed to load saved searches")}finally{p(!1)}},[]);m.useEffect(()=>{x()},[x]);const j=m.useCallback(async l=>{try{try{const s=await fetch("/api/v2/saved-searches",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(s.ok){const c=await s.json();return o(i=>[c,...i]),c}}catch{}const n={...l,id:Date.now(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()},a=[n,...t];return o(a),M(a),n}catch(n){throw h(n instanceof Error?n.message:"Failed to create saved search"),n}},[t]),v=m.useCallback(async(l,n)=>{try{try{const s=await fetch(`/api/v2/saved-searches/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(s.ok){const c=await s.json();return o(i=>i.map(S=>S.id===l?c:S)),c}}catch{}const a=t.map(s=>s.id===l?{...s,...n,updated_at:new Date().toISOString()}:s);o(a),M(a)}catch(a){throw h(a instanceof Error?a.message:"Failed to update saved search"),a}},[t]),u=m.useCallback(async l=>{try{try{if((await fetch(`/api/v2/saved-searches/${l}`,{method:"DELETE"})).ok){o(s=>s.filter(c=>c.id!==l));return}}catch{}const n=t.filter(a=>a.id!==l);o(n),M(n)}catch(n){throw h(n instanceof Error?n.message:"Failed to delete saved search"),n}},[t]);return{searches:t,loading:f,error:g,createSearch:j,updateSearch:v,deleteSearch:u,refresh:x}};function ze(){try{const t=localStorage.getItem(de);return t?JSON.parse(t):[]}catch{return[]}}function M(t){try{localStorage.setItem(de,JSON.stringify(t))}catch(o){console.error("Failed to save to localStorage:",o)}}function Ie(t,o){const f=new Set(o.map(g=>g.id)),p=t.filter(g=>!f.has(g.id));return[...o,...p]}const Be=({onSelectSearch:t})=>{const{searches:o,loading:f,createSearch:p,updateSearch:g,deleteSearch:h}=_e(),{isOpen:x,onOpen:j,onClose:v}=Q(),[u,l]=m.useState(null),[n,a]=m.useState({name:"",query:"",description:""}),s=te(),c=()=>{l(null),a({name:"",query:"",description:""}),j()},i=d=>{l(d),a({name:d.name,query:d.query,description:d.description||""}),j()},S=async()=>{try{u?(await g(u.id,n),s({title:"Search updated",status:"success",duration:2e3})):(await p(n),s({title:"Search saved",status:"success",duration:2e3})),v()}catch(d){s({title:"Error",description:d instanceof Error?d.message:"Failed to save search",status:"error",duration:3e3})}},r=async(d,ue)=>{if(window.confirm(`Delete saved search "${ue}"?`))try{await h(d),s({title:"Search deleted",status:"success",duration:2e3})}catch{s({title:"Error",description:"Failed to delete search",status:"error",duration:3e3})}},b=d=>{t&&t(d)};return f?e.jsx(k,{p:4,children:e.jsx(y,{fontSize:"sm",color:"gray.600",children:"Loading saved searches..."})}):e.jsxs(k,{children:[e.jsxs(w,{justify:"space-between",mb:4,children:[e.jsx(y,{fontWeight:"bold",fontSize:"md",children:"Saved Searches"}),e.jsx(pe,{label:"Save new search",children:e.jsx(T,{"aria-label":"Save new search",icon:e.jsx(Ee,{}),size:"xs",onClick:c})})]}),o.length===0?e.jsxs(k,{p:4,bg:"gray.50",borderRadius:"md",children:[e.jsx(y,{fontSize:"sm",color:"gray.600",textAlign:"center",children:"No saved searches yet"}),e.jsx(E,{size:"sm",mt:2,onClick:c,width:"full",children:"Create your first search"})]}):e.jsx(C,{align:"stretch",spacing:2,children:o.map(d=>e.jsx(k,{p:3,bg:"white",borderRadius:"md",borderWidth:1,borderColor:"gray.200",_hover:{borderColor:"blue.300",bg:"blue.50"},transition:"all 0.2s",children:e.jsxs(w,{justify:"space-between",align:"start",children:[e.jsxs(C,{align:"stretch",spacing:1,flex:1,children:[e.jsx(y,{fontWeight:"medium",fontSize:"sm",children:d.name}),e.jsx(y,{fontSize:"xs",color:"gray.600",noOfLines:1,children:d.query}),d.description&&e.jsx(y,{fontSize:"xs",color:"gray.500",noOfLines:2,children:d.description})]}),e.jsxs(ae,{children:[e.jsx(re,{as:T,icon:e.jsx(oe,{}),size:"xs",variant:"ghost","aria-label":"Search options"}),e.jsxs(ne,{fontSize:"sm",children:[e.jsx(_,{icon:e.jsx(xe,{}),onClick:()=>b(d.query),children:"Execute Search"}),e.jsx(_,{icon:e.jsx(le,{}),onClick:()=>i(d),children:"Edit"}),e.jsx(Z,{}),e.jsx(_,{icon:e.jsx(ie,{}),onClick:()=>r(d.id,d.name),color:"red.600",children:"Delete"})]})]})]})},d.id))}),e.jsxs(X,{isOpen:x,onClose:v,children:[e.jsx(ee,{}),e.jsxs(se,{children:[e.jsxs(q,{children:[u?"Edit":"Save"," Search"]}),e.jsx(H,{}),e.jsx(R,{children:e.jsxs(C,{spacing:4,children:[e.jsxs(k,{width:"full",children:[e.jsx(y,{fontSize:"sm",fontWeight:"medium",mb:1,children:"Name"}),e.jsx(D,{placeholder:"e.g., User Messages",value:n.name,onChange:d=>a({...n,name:d.target.value})})]}),e.jsxs(k,{width:"full",children:[e.jsx(y,{fontSize:"sm",fontWeight:"medium",mb:1,children:"Query"}),e.jsx(D,{placeholder:"e.g., user entity:message",value:n.query,onChange:d=>a({...n,query:d.target.value})})]}),e.jsxs(k,{width:"full",children:[e.jsx(y,{fontSize:"sm",fontWeight:"medium",mb:1,children:"Description (optional)"}),e.jsx(ce,{placeholder:"Add notes about this search...",value:n.description,onChange:d=>a({...n,description:d.target.value}),rows:3})]})]})}),e.jsxs($,{children:[e.jsx(E,{variant:"ghost",mr:3,onClick:v,children:"Cancel"}),e.jsx(E,{colorScheme:"blue",onClick:S,isDisabled:!n.name||!n.query,children:u?"Update":"Save"})]})]})]})]})},he="spoke_bookmarks",Ne=()=>{const[t,o]=m.useState([]),[f,p]=m.useState(!0),[g,h]=m.useState(null),x=m.useCallback(async()=>{p(!0),h(null);try{const a=Me();o(a);try{const s=await fetch("/api/v2/bookmarks");if(s.ok){const i=(await s.json()).bookmarks||[];o(Oe(a,i))}}catch{console.log("API not available, using localStorage only")}}catch(a){h(a instanceof Error?a.message:"Failed to load bookmarks")}finally{p(!1)}},[]);m.useEffect(()=>{x()},[x]);const j=m.useCallback((a,s,c)=>t.some(i=>i.module_name===a&&i.version===s&&(c===void 0||i.entity_path===c)),[t]),v=m.useCallback(async a=>{try{try{const i=await fetch("/api/v2/bookmarks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(i.ok){const S=await i.json();return o(r=>[S,...r]),S}}catch{}const s={...a,id:Date.now(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()},c=[s,...t];return o(c),O(c),s}catch(s){throw h(s instanceof Error?s.message:"Failed to create bookmark"),s}},[t]),u=m.useCallback(async(a,s)=>{try{try{const i=await fetch(`/api/v2/bookmarks/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(i.ok){const S=await i.json();return o(r=>r.map(b=>b.id===a?S:b)),S}}catch{}const c=t.map(i=>i.id===a?{...i,...s,updated_at:new Date().toISOString()}:i);o(c),O(c)}catch(c){throw h(c instanceof Error?c.message:"Failed to update bookmark"),c}},[t]),l=m.useCallback(async a=>{try{try{if((await fetch(`/api/v2/bookmarks/${a}`,{method:"DELETE"})).ok){o(i=>i.filter(S=>S.id!==a));return}}catch{}const s=t.filter(c=>c.id!==a);o(s),O(s)}catch(s){throw h(s instanceof Error?s.message:"Failed to delete bookmark"),s}},[t]),n=m.useCallback(async(a,s,c)=>{const i=t.find(S=>S.module_name===a&&S.version===s&&(c===void 0||S.entity_path===c));i?await l(i.id):await v({module_name:a,version:s,entity_path:c})},[t,v,l]);return{bookmarks:t,loading:f,error:g,isBookmarked:j,createBookmark:v,updateBookmark:u,deleteBookmark:l,toggleBookmark:n,refresh:x}};function Me(){try{const t=localStorage.getItem(he);return t?JSON.parse(t):[]}catch{return[]}}function O(t){try{localStorage.setItem(he,JSON.stringify(t))}catch(o){console.error("Failed to save to localStorage:",o)}}function Oe(t,o){const f=new Set(o.map(g=>g.id)),p=t.filter(g=>!f.has(g.id));return[...o,...p]}const Te=()=>{const{bookmarks:t,loading:o,updateBookmark:f,deleteBookmark:p}=Ne(),{isOpen:g,onOpen:h,onClose:x}=Q(),[j,v]=m.useState(null),[u,l]=m.useState({notes:"",tags:[],tagInput:""}),n=te(),a=r=>{v(r),l({notes:r.notes||"",tags:r.tags||[],tagInput:""}),h()},s=async()=>{if(j)try{await f(j.id,{notes:u.notes,tags:u.tags}),n({title:"Bookmark updated",status:"success",duration:2e3}),x()}catch{n({title:"Error",description:"Failed to update bookmark",status:"error",duration:3e3})}},c=async(r,b)=>{if(window.confirm(`Remove bookmark for "${b}"?`))try{await p(r),n({title:"Bookmark removed",status:"success",duration:2e3})}catch{n({title:"Error",description:"Failed to delete bookmark",status:"error",duration:3e3})}},i=()=>{u.tagInput.trim()&&!u.tags.includes(u.tagInput.trim())&&l({...u,tags:[...u.tags,u.tagInput.trim()],tagInput:""})},S=r=>{l({...u,tags:u.tags.filter(b=>b!==r)})};return o?e.jsx(k,{p:4,children:e.jsx(y,{fontSize:"sm",color:"gray.600",children:"Loading bookmarks..."})}):e.jsxs(k,{children:[e.jsxs(w,{justify:"space-between",mb:4,children:[e.jsx(y,{fontWeight:"bold",fontSize:"md",children:"Bookmarks"}),e.jsx(z,{colorScheme:"blue",children:t.length})]}),t.length===0?e.jsxs(k,{p:4,bg:"gray.50",borderRadius:"md",children:[e.jsx(y,{fontSize:"sm",color:"gray.600",textAlign:"center",children:"No bookmarks yet"}),e.jsx(y,{fontSize:"xs",color:"gray.500",mt:2,textAlign:"center",children:"Click the star icon on any module to bookmark it"})]}):e.jsx(C,{align:"stretch",spacing:2,children:t.map(r=>e.jsx(k,{p:3,bg:"white",borderRadius:"md",borderWidth:1,borderColor:"gray.200",_hover:{borderColor:"orange.300",bg:"orange.50"},transition:"all 0.2s",children:e.jsxs(w,{justify:"space-between",align:"start",children:[e.jsxs(C,{align:"stretch",spacing:1,flex:1,children:[e.jsxs(w,{children:[e.jsx(J,{color:"orange.400",boxSize:3}),e.jsx(je,{as:L,to:`/modules/${r.module_name}?version=${r.version}`,fontWeight:"medium",fontSize:"sm",color:"blue.600",_hover:{textDecoration:"underline"},children:r.module_name})]}),e.jsxs(w,{spacing:2,children:[e.jsx(z,{colorScheme:"gray",fontSize:"xs",children:r.version}),r.entity_type&&e.jsx(z,{colorScheme:"purple",fontSize:"xs",children:r.entity_type})]}),r.entity_path&&e.jsx(y,{fontSize:"xs",color:"gray.600",children:r.entity_path}),r.notes&&e.jsx(y,{fontSize:"xs",color:"gray.500",noOfLines:2,children:r.notes}),r.tags&&r.tags.length>0&&e.jsx(V,{spacing:1,mt:1,children:r.tags.map(b=>e.jsx(P,{children:e.jsx(U,{size:"sm",colorScheme:"blue",variant:"subtle",children:b})},b))})]}),e.jsxs(ae,{children:[e.jsx(re,{as:T,icon:e.jsx(oe,{}),size:"xs",variant:"ghost","aria-label":"Bookmark options"}),e.jsxs(ne,{fontSize:"sm",children:[e.jsx(_,{icon:e.jsx(we,{}),as:L,to:`/modules/${r.module_name}?version=${r.version}`,children:"Open Module"}),e.jsx(_,{icon:e.jsx(le,{}),onClick:()=>a(r),children:"Edit Notes & Tags"}),e.jsx(Z,{}),e.jsx(_,{icon:e.jsx(ie,{}),onClick:()=>c(r.id,r.module_name),color:"red.600",children:"Remove Bookmark"})]})]})]})},r.id))}),e.jsxs(X,{isOpen:g,onClose:x,children:[e.jsx(ee,{}),e.jsxs(se,{children:[e.jsx(q,{children:"Edit Bookmark"}),e.jsx(H,{}),e.jsx(R,{children:e.jsxs(C,{spacing:4,children:[j&&e.jsxs(k,{width:"full",p:3,bg:"gray.50",borderRadius:"md",children:[e.jsxs(w,{children:[e.jsx(J,{color:"orange.400",boxSize:3}),e.jsx(y,{fontWeight:"bold",fontSize:"sm",children:j.module_name}),e.jsx(z,{colorScheme:"gray",fontSize:"xs",children:j.version})]}),j.entity_path&&e.jsx(y,{fontSize:"xs",color:"gray.600",mt:1,children:j.entity_path})]}),e.jsxs(k,{width:"full",children:[e.jsx(y,{fontSize:"sm",fontWeight:"medium",mb:1,children:"Notes"}),e.jsx(ce,{placeholder:"Add notes about this bookmark...",value:u.notes,onChange:r=>l({...u,notes:r.target.value}),rows:4})]}),e.jsxs(k,{width:"full",children:[e.jsx(y,{fontSize:"sm",fontWeight:"medium",mb:1,children:"Tags"}),e.jsxs(w,{children:[e.jsx(D,{placeholder:"Add tag...",value:u.tagInput,onChange:r=>l({...u,tagInput:r.target.value}),onKeyPress:r=>r.key==="Enter"&&i(),size:"sm"}),e.jsx(E,{size:"sm",onClick:i,children:"Add"})]}),u.tags.length>0&&e.jsx(V,{spacing:2,mt:2,children:u.tags.map(r=>e.jsx(P,{children:e.jsxs(U,{size:"sm",colorScheme:"blue",children:[e.jsx(fe,{children:r}),e.jsx(ye,{onClick:()=>S(r)})]})},r))})]})]})}),e.jsxs($,{children:[e.jsx(E,{variant:"ghost",mr:3,onClick:x,children:"Cancel"}),e.jsx(E,{colorScheme:"blue",onClick:s,children:"Save"})]})]})]})]})},Re=()=>e.jsx(Se,{maxW:"container.xl",py:8,children:e.jsxs(C,{align:"stretch",spacing:6,children:[e.jsxs(Ce,{spacing:"8px",separator:e.jsx(ve,{color:"gray.500"}),children:[e.jsx(G,{children:e.jsx(K,{as:L,to:"/",children:"Home"})}),e.jsx(G,{isCurrentPage:!0,children:e.jsx(K,{children:"My Library"})})]}),e.jsx(ke,{size:"lg",children:"My Library"}),e.jsxs(be,{columns:{base:1,md:2},spacing:8,children:[e.jsx(k,{bg:"white",p:6,borderRadius:"lg",borderWidth:1,shadow:"sm",children:e.jsx(Be,{})}),e.jsx(k,{bg:"white",p:6,borderRadius:"lg",borderWidth:1,shadow:"sm",children:e.jsx(Te,{})})]})]})});export{Re as UserFeatures};

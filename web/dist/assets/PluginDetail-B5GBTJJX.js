import{j as e,aD as S,r as h,f as g}from"./index-DWlraR88.js";import{a as m,p as _,b as k,c as y,d as D,e as L,f as C,S as B}from"./StarRating-BrZwj9Tp.js";import"./useQuery-DUTFTxH0.js";function F({reviews:t}){return t.length===0?e.jsx("div",{className:"empty-reviews",children:e.jsx("p",{children:"No reviews yet. Be the first to review this plugin!"})}):e.jsx("div",{className:"review-list",children:t.map(a=>e.jsxs("div",{className:"review-item",children:[e.jsxs("div",{className:"review-header",children:[e.jsxs("div",{className:"review-author",children:[e.jsx("span",{className:"author-name",children:a.user_name||a.user_id}),e.jsx(m,{rating:a.rating,size:"small"})]}),e.jsx("span",{className:"review-date",children:new Date(a.created_at).toLocaleDateString()})]}),a.review&&e.jsx("div",{className:"review-content",children:e.jsx("p",{children:a.review})}),a.updated_at!==a.created_at&&e.jsx("div",{className:"review-footer",children:e.jsxs("span",{className:"edited-label",children:["Edited ",new Date(a.updated_at).toLocaleDateString()]})})]},a.id))})}function P({versions:t,pluginId:a}){const r=i=>{if(i===0)return"0 B";const n=1024,c=["B","KB","MB","GB"],d=Math.floor(Math.log(i)/Math.log(n));return`${(i/Math.pow(n,d)).toFixed(1)} ${c[d]}`},l=async i=>{try{const n=await _.downloadPlugin(a,i);window.location.href=n}catch{alert("Failed to download plugin")}};return t.length===0?e.jsx("div",{className:"empty-versions",children:e.jsx("p",{children:"No versions available"})}):e.jsx("div",{className:"version-list",children:e.jsxs("table",{className:"versions-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Version"}),e.jsx("th",{children:"API Version"}),e.jsx("th",{children:"Size"}),e.jsx("th",{children:"Downloads"}),e.jsx("th",{children:"Released"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map(i=>e.jsxs("tr",{children:[e.jsx("td",{className:"version-column",children:e.jsx("span",{className:"version-number",children:i.version})}),e.jsx("td",{className:"api-version-column",children:i.api_version}),e.jsx("td",{className:"size-column",children:r(i.size_bytes)}),e.jsx("td",{className:"downloads-column",children:i.downloads.toLocaleString()}),e.jsx("td",{className:"date-column",children:new Date(i.created_at).toLocaleDateString()}),e.jsx("td",{className:"actions-column",children:e.jsx("button",{onClick:()=>l(i.version),className:"download-button",title:"Download this version",children:"Download"})})]},i.id))})]})})}function z(){const{id:t}=S(),[a,r]=h.useState("overview"),[l,i]=h.useState(!1),[n,c]=h.useState(5),[d,v]=h.useState(""),{data:s,isLoading:p,error:w}=k(t),{data:o}=y(t),{data:N}=D(t),x=L(t),b=C(),f=()=>{s!=null&&s.latest_version&&b.mutate({pluginId:t,version:s.latest_version},{onSuccess:()=>{alert(`Installation of ${s.name} ${s.latest_version} recorded!`)}})},R=u=>{u.preventDefault(),x.mutate({rating:n,review:d},{onSuccess:()=>{i(!1),v(""),c(5),alert("Review submitted successfully!")},onError:j=>{alert(`Failed to submit review: ${j instanceof Error?j.message:"Unknown error"}`)}})};return p?e.jsxs("div",{className:"plugin-detail loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading plugin details..."})]}):w||!s?e.jsxs("div",{className:"plugin-detail error",children:[e.jsx("h2",{children:"Plugin Not Found"}),e.jsx("p",{children:"The requested plugin could not be found."}),e.jsx(g,{to:"/plugins",className:"back-link",children:"← Back to Marketplace"})]}):e.jsxs("div",{className:"plugin-detail",children:[e.jsxs("div",{className:"plugin-header",children:[e.jsx(g,{to:"/plugins",className:"back-link",children:"← Back to Marketplace"}),e.jsxs("div",{className:"header-content",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("h1",{children:s.name}),e.jsxs("div",{className:"header-badges",children:[e.jsx(B,{level:s.security_level}),e.jsx("span",{className:"type-badge",children:s.type})]}),e.jsx("p",{className:"plugin-description-full",children:s.description})]}),e.jsxs("div",{className:"header-right",children:[e.jsxs("button",{onClick:f,className:"install-button",disabled:!s.latest_version,children:["Install ",s.latest_version||""]}),e.jsxs("div",{className:"plugin-stats-summary",children:[e.jsxs("div",{className:"stat",children:[e.jsx(m,{rating:s.avg_rating||0,size:"medium"}),e.jsxs("span",{className:"stat-label",children:[s.review_count||0," reviews"]})]}),e.jsxs("div",{className:"stat",children:[e.jsx("span",{className:"stat-value",children:s.download_count.toLocaleString()}),e.jsx("span",{className:"stat-label",children:"downloads"})]})]})]})]})]}),e.jsxs("div",{className:"plugin-tabs",children:[e.jsx("button",{className:`tab ${a==="overview"?"active":""}`,onClick:()=>r("overview"),children:"Overview"}),e.jsxs("button",{className:`tab ${a==="versions"?"active":""}`,onClick:()=>r("versions"),children:["Versions (",(o==null?void 0:o.length)||0,")"]}),e.jsxs("button",{className:`tab ${a==="reviews"?"active":""}`,onClick:()=>r("reviews"),children:["Reviews (",s.review_count||0,")"]})]}),e.jsxs("div",{className:"plugin-content",children:[a==="overview"&&e.jsx("div",{className:"overview-tab",children:e.jsxs("div",{className:"info-section",children:[e.jsx("h2",{children:"Information"}),e.jsxs("dl",{className:"info-list",children:[e.jsx("dt",{children:"Author:"}),e.jsx("dd",{children:s.author}),s.license&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"License:"}),e.jsx("dd",{children:s.license})]}),s.homepage&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"Homepage:"}),e.jsx("dd",{children:e.jsx("a",{href:s.homepage,target:"_blank",rel:"noopener noreferrer",children:s.homepage})})]}),s.repository&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"Repository:"}),e.jsx("dd",{children:e.jsx("a",{href:s.repository,target:"_blank",rel:"noopener noreferrer",children:s.repository})})]}),e.jsx("dt",{children:"Latest Version:"}),e.jsx("dd",{children:s.latest_version||"N/A"}),e.jsx("dt",{children:"Created:"}),e.jsx("dd",{children:new Date(s.created_at).toLocaleDateString()}),e.jsx("dt",{children:"Updated:"}),e.jsx("dd",{children:new Date(s.updated_at).toLocaleDateString()})]})]})}),a==="versions"&&e.jsx("div",{className:"versions-tab",children:e.jsx(P,{versions:o||[],pluginId:t})}),a==="reviews"&&e.jsxs("div",{className:"reviews-tab",children:[e.jsxs("div",{className:"reviews-header",children:[e.jsx("h2",{children:"User Reviews"}),e.jsx("button",{onClick:()=>i(!l),className:"write-review-button",children:l?"Cancel":"Write a Review"})]}),l&&e.jsxs("form",{onSubmit:R,className:"review-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Rating:"}),e.jsx(m,{rating:n,size:"large",interactive:!0,onRatingChange:c})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"review-text",children:"Review:"}),e.jsx("textarea",{id:"review-text",value:d,onChange:u=>v(u.target.value),rows:5,placeholder:"Share your experience with this plugin...",required:!0})]}),e.jsx("button",{type:"submit",className:"submit-review-button",disabled:x.isPending,children:x.isPending?"Submitting...":"Submit Review"})]}),e.jsx(F,{reviews:N||[]})]})]})]})}export{z as default};

var B=Object.defineProperty;var j=t=>{throw TypeError(t)};var T=(t,e,s)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var F=(t,e,s)=>T(t,typeof e!="symbol"?e+"":e,s),$=(t,e,s)=>e.has(t)||j("Cannot "+s);var r=(t,e,s)=>($(t,e,"read from private field"),s?s.call(t):e.get(t)),b=(t,e,s)=>e.has(t)?j("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),w=(t,e,s,i)=>($(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),S=(t,e,s)=>($(t,e,"access private method"),s);import{u as x}from"./useQuery-DUTFTxH0.js";import{aE as V,aF as A,aG as L,aH as I,aI as U,aJ as E,r as C,aK as N,aL as D,aC as H,j as K}from"./index-DWlraR88.js";var d,m,o,p,y,M,O,Q,_=(Q=class extends V{constructor(e,s){super();b(this,y);b(this,d);b(this,m);b(this,o);b(this,p);w(this,d,e),this.setOptions(s),this.bindMethods(),S(this,y,M).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var i;const s=this.options;this.options=r(this,d).defaultMutationOptions(e),A(this.options,s)||r(this,d).getMutationCache().notify({type:"observerOptionsUpdated",mutation:r(this,o),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&L(s.mutationKey)!==L(this.options.mutationKey)?this.reset():((i=r(this,o))==null?void 0:i.state.status)==="pending"&&r(this,o).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=r(this,o))==null||e.removeObserver(this)}onMutationUpdate(e){S(this,y,M).call(this),S(this,y,O).call(this,e)}getCurrentResult(){return r(this,m)}reset(){var e;(e=r(this,o))==null||e.removeObserver(this),w(this,o,void 0),S(this,y,M).call(this),S(this,y,O).call(this)}mutate(e,s){var i;return w(this,p,s),(i=r(this,o))==null||i.removeObserver(this),w(this,o,r(this,d).getMutationCache().build(r(this,d),this.options)),r(this,o).addObserver(this),r(this,o).execute(e)}},d=new WeakMap,m=new WeakMap,o=new WeakMap,p=new WeakMap,y=new WeakSet,M=function(){var s;const e=((s=r(this,o))==null?void 0:s.state)??I();w(this,m,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},O=function(e){U.batch(()=>{var s,i,n,f,h,v,R,q;if(r(this,p)&&this.hasListeners()){const g=r(this,m).variables,l=r(this,m).context,c={client:r(this,d),meta:this.options.meta,mutationKey:this.options.mutationKey};if((e==null?void 0:e.type)==="success"){try{(i=(s=r(this,p)).onSuccess)==null||i.call(s,e.data,g,l,c)}catch(u){Promise.reject(u)}try{(f=(n=r(this,p)).onSettled)==null||f.call(n,e.data,null,g,l,c)}catch(u){Promise.reject(u)}}else if((e==null?void 0:e.type)==="error"){try{(v=(h=r(this,p)).onError)==null||v.call(h,e.error,g,l,c)}catch(u){Promise.reject(u)}try{(q=(R=r(this,p)).onSettled)==null||q.call(R,void 0,e.error,g,l,c)}catch(u){Promise.reject(u)}}}this.listeners.forEach(g=>{g(r(this,m))})})},Q);function k(t,e){const s=E(),[i]=C.useState(()=>new _(s,t));C.useEffect(()=>{i.setOptions(t)},[i,t]);const n=C.useSyncExternalStore(C.useCallback(h=>i.subscribe(U.batchCalls(h)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),f=C.useCallback((h,v)=>{i.mutate(h,v).catch(N)},[i]);if(n.error&&D(i.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:f,mutateAsync:n.mutate}}class z{constructor(e="/api/v1"){F(this,"api");this.api=H.create({baseURL:e,headers:{"Content-Type":"application/json"}})}async listPlugins(e){return(await this.api.get("/plugins",{params:e})).data}async searchPlugins(e,s){return(await this.api.get("/plugins/search",{params:{q:e,...s}})).data}async getTrendingPlugins(e=10){return(await this.api.get("/plugins/trending",{params:{limit:e}})).data}async getPlugin(e){return(await this.api.get(`/plugins/${e}`)).data}async listVersions(e){return(await this.api.get(`/plugins/${e}/versions`)).data}async getVersion(e,s){return(await this.api.get(`/plugins/${e}/versions/${s}`)).data}async downloadPlugin(e,s){return(await this.api.get(`/plugins/${e}/versions/${s}/download`,{maxRedirects:0,validateStatus:n=>n===302})).headers.location}async listReviews(e,s=20,i=0){return(await this.api.get(`/plugins/${e}/reviews`,{params:{limit:s,offset:i}})).data}async createReview(e,s){await this.api.post(`/plugins/${e}/reviews`,s)}async recordInstallation(e,s){await this.api.post(`/plugins/${e}/install`,{version:s})}async recordUninstallation(e){await this.api.post(`/plugins/${e}/uninstall`)}async getPluginStats(e,s=30){return(await this.api.get(`/plugins/${e}/stats`,{params:{days:s}})).data}setAuthToken(e){this.api.defaults.headers.common.Authorization=`Bearer ${e}`}setUserId(e){this.api.defaults.headers.common["X-User-ID"]=e}}const P=new z,a={all:["plugins"],lists:()=>[...a.all,"list"],list:t=>[...a.lists(),t],details:()=>[...a.all,"detail"],detail:t=>[...a.details(),t],versions:t=>[...a.detail(t),"versions"],reviews:t=>[...a.detail(t),"reviews"],stats:t=>[...a.detail(t),"stats"],trending:()=>[...a.all,"trending"]};function W(t){return x({queryKey:a.list(t),queryFn:()=>P.listPlugins(t),staleTime:60*1e3})}function Y(t){return x({queryKey:a.detail(t),queryFn:()=>P.getPlugin(t),enabled:!!t})}function Z(t){return x({queryKey:a.versions(t),queryFn:()=>P.listVersions(t),enabled:!!t})}function ee(t,e=20,s=0){return x({queryKey:[...a.reviews(t),e,s],queryFn:()=>P.listReviews(t,e,s),enabled:!!t})}function te(t){const e=E();return k({mutationFn:s=>P.createReview(t,s),onSuccess:()=>{e.invalidateQueries({queryKey:a.reviews(t)}),e.invalidateQueries({queryKey:a.detail(t)})}})}function se(){const t=E();return k({mutationFn:({pluginId:e,version:s})=>P.recordInstallation(e,s),onSuccess:(e,s)=>{t.invalidateQueries({queryKey:a.stats(s.pluginId)}),t.invalidateQueries({queryKey:a.detail(s.pluginId)})}})}function ie({level:t}){const e=()=>{switch(t){case"official":return"security-badge official";case"verified":return"security-badge verified";case"community":return"security-badge community";default:return"security-badge"}},s=()=>{switch(t){case"official":return"✓";case"verified":return"✓";case"community":return"○";default:return""}},i=()=>{switch(t){case"official":return"Official";case"verified":return"Verified";case"community":return"Community";default:return t}};return K.jsxs("span",{className:e(),title:`Security Level: ${i()}`,children:[s()," ",i()]})}function re({rating:t,maxRating:e=5,size:s="small",interactive:i=!1,onRatingChange:n}){const[f,h]=C.useState(null),v=l=>{const c=f!==null?f:t;return l<=Math.floor(c)?"star filled":l===Math.ceil(c)&&c%1!==0?"star half-filled":"star empty"},R=l=>{i&&n&&n(l)},q=l=>{i&&h(l)},g=()=>{i&&h(null)};return K.jsxs("div",{className:`star-rating ${s} ${i?"interactive":""}`,children:[Array.from({length:e},(l,c)=>{const u=c+1;return K.jsx("span",{className:v(u),onClick:()=>R(u),onMouseEnter:()=>q(u),onMouseLeave:g,role:i?"button":void 0,"aria-label":`${u} stars`,children:"★"},u)}),K.jsx("span",{className:"rating-value",children:t.toFixed(1)})]})}export{ie as S,re as a,Y as b,Z as c,ee as d,te as e,se as f,P as p,W as u};
